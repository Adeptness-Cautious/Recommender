# -*- coding: utf-8 -*-
"""matrix_factorization.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1TcxsONQVJa3nu_vHVFLc4h2Ekty2uBK4

#Importing the required modules
"""

# Commented out IPython magic to ensure Python compatibility.
# Ignore  the warnings
import warnings
warnings.filterwarnings('always')
warnings.filterwarnings('ignore')

# data visualisation and manipulation
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib import style
import seaborn as sns
import tensorflow as tf
 
#configure
# sets matplotlib to inline and displays graphs below the corressponding cell.
# %matplotlib inline  
style.use('fivethirtyeight')
sns.set(style='whitegrid',color_codes=True)

#model selection
from sklearn.model_selection import train_test_split
from sklearn.model_selection import KFold
from sklearn.metrics import accuracy_score,precision_score,recall_score,confusion_matrix,roc_curve,roc_auc_score
from sklearn.metrics import mean_absolute_error
from sklearn.model_selection import GridSearchCV
from sklearn.preprocessing import LabelEncoder

#preprocess.
from keras.preprocessing.image import ImageDataGenerator

#dl libraraies
import keras
from keras import backend as K
from keras.models import Sequential
from keras.layers import Dense , Concatenate
from keras.optimizers import Adam,SGD,Adagrad,Adadelta,RMSprop
from keras.utils import to_categorical
from keras.utils.vis_utils import model_to_dot
from keras.callbacks import ReduceLROnPlateau


# from tf.keras.layers import Dot
from keras.models import Model


# specifically for deeplearning.
from keras.layers import Dropout, Flatten,Activation,Input,Embedding
from keras.layers import Conv2D, MaxPooling2D, BatchNormalization
import tensorflow as tf
import random as rn
from IPython.display import SVG
 
# specifically for manipulating zipped images and getting numpy arrays of pixel values of images.
import cv2                  
import numpy as np  
from tqdm import tqdm
import os                   
from random import shuffle  
from zipfile import ZipFile
from PIL import Image


#TL pecific modules
from keras.applications.vgg16 import VGG16

import pandas as pd
import numpy as np

from torch.utils.data import Dataset
from torch.utils.data.dataset import T_co
import torch


class RatingMatrixDataset(Dataset):

    # Init functions as a simple standard setup preparation of data by creating the user and item matricies.
    # For implementations that save data, saving the data past this initial init is computationally effective.
    def __init__(self, destinations, neg_size):
        # Import data
        import pandas as pd
        COLS = ['user_id', 'movie_id', 'rating', 'timestamp']
        data = None
        for destination in destinations:
            if data is None:
                data = pd.read_csv(destination, sep='\t', names=COLS).astype(int)
            else:
                new_data = pd.read_csv(destination, sep='\t', names=COLS).astype(int)
                data = pd.concat([data, new_data], axis=0)

        # Normalize rating data
        data['rating'] = data['rating'] / 5
        data = data.reset_index()

        # Create (num of users) 1x(num of movies) vectors to represent users
        self.user_matrix = torch.zeros(943, 1682)
        self.item_matrix = torch.zeros(1682, 943)
        for index, row in data.iterrows():
            self.user_matrix[int(row['user_id']) - 1][int(row['movie_id']) - 1] = row['rating']
            self.item_matrix[int(row['movie_id']) - 1][int(row['user_id'] - 1)] = row['rating']

        # Creating max value of every user rating. Normally 1, but on occasion lower.
        self.user_max = torch.max(self.user_matrix, dim=1)

        # For negative set later on
        self.neg_size = neg_size
        self.negative_set = None

    def __getitem__(self, idx):
        # Getting item index and rated item
        y = torch.where(self.user_matrix[idx] != 0)
        z = torch.randperm(y[0].shape[0])
        item_idx = int(y[0][int(z[0])])

        # Getting negative set for each item
        negative_set = torch.zeros(self.item_matrix.shape[0], self.neg_size)
        y_2 = torch.where(self.user_matrix[idx] == 0)
        z_2 = torch.randperm(y_2[0].shape[0])
        item_idx_2 = torch.searchsorted(y_2[0], z_2[0:self.neg_size])
        negative_set = [self.item_matrix[i, :] for i in item_idx_2]
        negative_set = torch.stack(negative_set)

        return self.user_matrix[idx], self.item_matrix[item_idx], item_idx, negative_set

    # Simple return length
    def __len__(self):
        return len(self.user_matrix)

train = pd.read_csv('u.data', delimiter="\t")

df = train.copy()

df.columns = ["userId", "movieId", "rating", "timestamp"]

df.head()

len(df['userId'].unique())

df['movieId'].unique()

len(df['movieId'].unique())

df['rating'].max()

"""#Preparing the data

##Encoding the cloumns
"""

df.userId = df.userId.astype('category').cat.codes.values
df.movieId = df.movieId.astype('category').cat.codes.values

df['userId'].value_counts(ascending=True)

df['movieId'].unique()

"""##Creating the Utility Matrix"""

# creating utility matrix.
index=list(df['userId'].unique())
columns=list(df['movieId'].unique())
index=sorted(index)
columns=sorted(columns)
 
util_df=pd.pivot_table(data=df,values='rating',index='userId',columns='movieId')
# Nan implies that user has not rated the corressponding movie.

util_df

util_df.fillna(0)

"""##Creating Training and Validation Sets"""

# x_train,x_test,y_train,y_test=train_test_split(df[['userId','movieId']],df[['rating']],test_size=0.20,random_state=42)
users = df.userId.unique()
movies = df.movieId.unique()

userid2idx = {o:i for i,o in enumerate(users)}
movieid2idx = {o:i for i,o in enumerate(movies)}

df['userId'] = df['userId'].apply(lambda x: userid2idx[x])
df['movieId'] = df['movieId'].apply(lambda x: movieid2idx[x])
split = np.random.rand(len(df)) < 0.8
train = df[split]
valid = df[~split]
print(train.shape , valid.shape)

"""#Matrix Factorizarion

##Creating the Embeddings, Merging and Making the model from Embeddings
"""

n_movies=len(df['movieId'].unique())
n_users=len(df['userId'].unique())
n_latent_factors=64  # hyperparamter to deal with.

user_input=Input(shape=(1,),name='user_input',dtype='int64')

user_embedding=Embedding(n_users,n_latent_factors,name='user_embedding')(user_input)
#user_embedding.shape

user_vec =Flatten(name='FlattenUsers')(user_embedding)
#user_vec.shape

movie_input=Input(shape=(1,),name='movie_input',dtype='int64')
movie_embedding=Embedding(n_movies,n_latent_factors,name='movie_embedding')(movie_input)
movie_vec=Flatten(name='FlattenMovies')(movie_embedding)
#movie_vec

sim=dot([user_vec,movie_vec],name='Simalarity-Dot-Product',axes=1)
model =keras.models.Model([user_input, movie_input],sim)

"""##Compiling the Model"""

model.compile(optimizer=Adam(lr=1e-4),loss='mse')

train.shape
batch_size=128
epochs=50

"""##Fitting on Training set & Validating on Validation Set."""

History = model.fit([train.userId,train.movieId],train.rating, batch_size=batch_size,
                              epochs =epochs, validation_data = ([valid.userId,valid.movieId],valid.rating),
                              verbose = 1)

"""#Evaluating the Model Performance"""

from pylab import rcParams
rcParams['figure.figsize'] = 10, 5
import matplotlib.pyplot as plt
plt.plot(History.history['loss'] , 'g')
plt.plot(History.history['val_loss'] , 'b')
plt.title('model loss')
plt.ylabel('loss')
plt.xlabel('epoch')
plt.legend(['train', 'test'], loc='upper left')
plt.grid(True)
plt.show()

"""![__results___49_0.png](data:image/png;base64,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)

#Using a Neural Network
"""

n_latent_factors=50
n_movies=len(df['movieId'].unique())
n_users=len(df['userId'].unique())

user_input=Input(shape=(1,),name='user_input',dtype='int64')
user_embedding=Embedding(n_users,n_latent_factors,name='user_embedding')(user_input)
user_vec=Flatten(name='FlattenUsers')(user_embedding)
user_vec=Dropout(0.40)(user_vec)

movie_input=Input(shape=(1,),name='movie_input',dtype='int64')
movie_embedding=Embedding(n_movies,n_latent_factors,name='movie_embedding')(movie_input)
movie_vec=Flatten(name='FlattenMovies')(movie_embedding)
movie_vec=Dropout(0.40)(movie_vec)

sim=dot([user_vec,movie_vec],name='Simalarity-Dot-Product',axes=1)

nn_inp=Dense(96,activation='relu')(sim)
nn_inp=Dropout(0.4)(nn_inp)
# nn_inp=BatchNormalization()(nn_inp)
nn_inp=Dense(1,activation='relu')(nn_inp)
nn_model =keras.models.Model([user_input, movie_input],nn_inp)
nn_model.summary()

nn_model.compile(optimizer=Adam(lr=1e-3),loss='mse')

batch_size=128
epochs=20

History = nn_model.fit([train.userId,train.movieId],train.rating, batch_size=batch_size,
                              epochs =epochs, validation_data = ([valid.userId,valid.movieId],valid.rating),
                              verbose = 1)

